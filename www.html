<%@page import="it.bol.framework.manager.BolTextManager"%>
<%@page import="it.bol.framework.manager.BolNavigationManager"%>
<%@page import="it.bol.framework.visitor.BolVisitorFactory"%>
<%@page import="it.bol.framework.visitor.BolVisitor"%>
<%@page import="it.bol.common.util.JspUtility.Templates"%>
<%@page import="it.bol.common.util.JspUtility.ActionType"%>
<%@page import="it.bol.common.util.JspUtility"%>
<%@page import="it.bol.money.enums.TipoFiltro"%>
<%@page import="it.bol.text.enums.CommonTextCategory"%>
<%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" errorPage="/pr/error.jsp"%>

<%
BolVisitor visitor = BolVisitorFactory.getInstance().getBolVisitor(request);
BolTextManager btm = BolTextManager.getInstance(visitor);
BolNavigationManager bnm = BolNavigationManager.getInstance(visitor);
String url_limiti = bnm.getBolPrivateUrlByNavParams(request, "nav_mmoy_impostazioni", "nav_mmoy_expenses_limit");
String url_confronta = bnm.getBolPrivateUrlByNavParams(request, "nav_mmoy_compare_expenses", "nav_mmoy_compare_expenses");

String limitActionURL = JspUtility.getPathAsRelative(request, ActionType.ACTION, Templates.PRI.MONEY_1L.template, "/money/limitInProgressDetail.action")+"?sezId=nav_mmoy_impostazioni&pageId=nav_mmoy_expenses_limit";
String limitActionURLNoLimit = JspUtility.getPathAsRelativeWithNavigator(request, "/pri/money/1l/action/money/expensesLimit.action")+"sezId=nav_mmoy_impostazioni&pageId=nav_mmoy_expenses_limit";
%>

<div class="wd_timeline wd_active" id="timelineDettaglioSpeseBySubCat"
     data-template="#timeline-timelineDettaglioSpeseBySubCat"
     data-template-day="#timeline-timelineDettaglioSpeseBySubCat-day"
     data-template-day-row="#timeline-timelineDettaglioSpeseBySubCat-day-row"
     data-form="#expensesFormFilter"
     data-json-url="<%=JspUtility.getPathAsRelativeWithNavigator(request,"/money/expensesSubCategoryTimelineJSON.action")%>"
data-init="true">
</div>
<script type="widiba-template/text" id="timeline-timelineDettaglioSpeseBySubCat">
    <div class="wd_money_col_section wd_money_col_header">

        <!-- CATEGORY LEGEND -->
        <div class="categoria_spesa">
            <span class="wd_icon_circle sprite_30x30 wd_font_icon_widiba wd_mm_type_icon_6d category icona_{icon}" style="background-color: rgb({color});"></span>
            <span class="wd_ellipsis" title="{name}">{name}</span>
        </div>

        <!-- AMOUNT LEGEND -->
        <div class="wd_grey_box" id="timelineImporto">
         <span id="timelineTitle"
               data-template-byPeriod-<%=TipoFiltro.ULTIMO_MESE.toString()%>="#lastMonthExpenses"
            data-template-byPeriod-<%=TipoFiltro.ULTIMI_SEI_MESI.toString()%>="#lastSixMonthsExpenses"
            data-template-byPeriod-<%=TipoFiltro.TUTTI.toString()%>="#expensesUntilToday"
            data-template-byDate="#expensesFromTo">
            <%=btm.getText(request, "totalExpenses")%>
            </span>
            <span id="timeLineNomeConto"></span>
            <span class="wd_totalAmount">{_defaultDashAmount_totalAmount}</span>
        </div>

        <!-- LIMIT SET/ CHANGE BOX -->
        <div class="limite_spesa">
            <form method="post" id="fomLimitRedirect" data-action-limit="<%=limitActionURL%>" data-action-no-limit="<%=url_limiti%>">
                <input type="hidden" name="idLimite" value="" id="limit_id" />
                <a class="actionButtonLimit">
                    <span class="wd_icon sprite_20x20 icon_limite turn-bg-off wd_font_icon_widiba wd_mm_type_icon_5f icona_88"></span>
	                <span class="actionLabelAddLimit" id="lblAddLimit"><%=btm.getText(request,  "expenseLimit")%>:<b><%=btm.getText(request, "none")%></b>
                        <div class="wd_right wd_link">
                            <span class="adjV"><%=btm.getText(request, "add")%></span><span class="wd_icon sprite_20x20 icon_limite turn-bg-off wd_font_icon_widiba wd_mm_type_icon_5f icona_258"></span>
                        </div>
	                </span>
	                <span class="actionLabelModifyLimit" style="display:none">
		                <%=btm.getText(request,  "expenseLimit")%>: <span><b></b></span> &euro;
                        <div class="wd_right wd_link">
                            <span class="adjV"><%=btm.getText(request, "modify")%></span>
                            <!-- <span class="wd_icon sprite_20x20 icon_limite turn-bg-off wd_font_icon_widiba wd_mm_type_icon_5f icona_258"></span> -->
                        </div>
	                </span>
                </a>
            </form>
        </div>

        <!-- DETTAGLIO SPESE / MODIFICA CATEGORIA -->
        <div class="dettaglioSpeseLabel">
            <div class="wd_subcategory_cat left"><p>Dettaglio spese</p></div>
            <div class="right">
                <a title="<%=btm.getText(request, "buttonChangeCategoryTransaction")%>"
                class="wd_button wd_button_aside wd_bgcolor_12" title="{buttonChangeCategory}" data-template="#button-checkCategory" data-categoryid="all">Modifica categoria</a>
            </div>
            <div class="clr"></div>
        </div>

        <!-- RADIO TYPE CHANGE -->
        <div class="wd_radio_select_wrapper">
            <div class="wd_radio_select_element wd_bgcolor_1">
                <input type="radio" id="selectTimelineSubcat"
                       data-template="#radio-selectTimeline"
                       name="selectTimeline"
                       checked="checked">
                <label for="selectTimelineSubcat"><%=btm.getText(request, "subcategoriesView")%></label>
            </div>
            <div class="wd_radio_select_element wd_bgcolor_1">
                <input type="radio" id="selectTimelineDate"
                       data-template="#radio-selectTimeline"
                       data-template="#radio-selectTimeline"
                       name="selectTimeline">
                <label for="selectTimelineDate"><%=btm.getText(request, "dateView")%></label>
            </div>
        </div>
    </div>

    <!-- INIZIO SCROLLABLE -->
    <div class="fakeTimelineHeader" id="headerfake">
        <div class="wd_timeline_firstLevel">
            <span id="primoValore">1° valore</span>
            <span id="secondoValore">2° valore</span>
        </div>
        <div class="clr"></div>
    </div>

    <div class="wd_money_col wd_scrollable probeType3">
        <div class="wd_scrollable_inner">
            <div class="timelineListContainer">
                <!-- ci vanno le sottocategorie -->
            </div>
        </div>

        <!--Money col fixed call to action-->
        <div class="wd_money_col_action_button">
            <a href="javascript:void(0)" class="wd_button wd_button_aside wd_button_xlarge wd_bgcolor_12"
               data-template="#popup-openPopupChangeCategory"
               data-popup="big"
               data-content="#popupChangeCategory"><span><%=btm.getText(request, "associatesCategory")%></span></a>
        </div>
    </div>
</script>


<script type="widiba-template/text" id="timeline-timelineDettaglioSpeseBySubCat-day">

    <div class="wd_money_col_section wd_timeline_firstLevel_header">
        <div class="wd_timeline_firstLevel">
            <div class="wd_subcategory_title left"><p class="wd_ellipsis" title="{firstLevelIDescription}">{firstLevelIDescription}</p></div>
            <div class="wd_subcategory_amount right"><p class="wd_text_right">{_amount_firstLevelItemAmount}</p></div>
            <div class="clr"></div>
        </div>
    </div>

    <div class="wd_money_col_section">
        <span class="wd_money_col_section_point"></span>
        <div class="wd_money_col_table wd_spese_box wd_money_col_table_dashed row_{firstLevelItemId}" >
            <!-- ci vanno le ri	ghe -->
        </div>
    </div>
</script>
<script type="widiba-template/text" id="timeline-timelineDettaglioSpeseBySubCat-day-row">
    <div class="wd_subcategory_spesa clr">
        <div class="wd_td_icon wd_td_icon_checkbox left">
            <input type="checkbox"
                   name="checkCategory-ID{secondLevelItemId}"
                   id="expenseID-{secondLevelItemId}"
                   data-transactionid="{secondLevelItemId}"
                   data-transactiondata="{secondLevelItemDate}"
                   data-transactiondatacompatta="{secondLevelItemCompactDate}"
                   data-transactiondesc="{secondLevelItemDescription}"
                   data-transactionam="{secondLevelItemAmount}"
                   data-template="#checkbox-checkCategory"
                   data-categoryid="{firstLevelItemId}">
            <label for="expenseID-{secondLevelItemId}" class="turn-bg-off wd_font_icon_widiba wd_mm_type_icon_6b icona_106"></label>
        </div>
        <div class="wd_money_col_table wd_money_col_table_inner">
            <div class="wd_td_icon right">
                <a href="javascript:void(0)" class="scontrino"
                   data-template="#popup-{secondLevelItemPhotoPopup}"
                   data-popup="big"
                   data-elementid="{secondLevelItemId}"
                   data-elementdescription="{secondLevelItemDescription}"
                   data-elementamount="{_amount_secondLevelItemAmount}"
                   data-elementcommentphoto="{secondLevelItemPhotoComment}"
                   data-elementphotourl="{secondLevelItemPhotoUrl}"
                   data-elementphotoid="{secondLevelItemPhotoId}"
                   data-elementcropurl="{secondLevelItemCropUrl}"
                   data-elementcropid="{secondLevelItemCropId}"
                   data-content="{secondLevelItemPhotoPopupContent}">
                    <span class="{secondLevelItemPhotoClass} wd_icon sprite_25x25 turn-bg-off wd_font_icon_widiba wd_mm_type_icon_5f icona_520" title="<%=btm.getCommonText(request, CommonTextCategory.MONEY, "buttonTakePicture")%>"></span>
                    <span class="{secondLevelItemPhotoBisClass} wd_icon sprite_25x25 turn-bg-off wd_font_icon_widiba wd_mm_type_icon_5f icona_425" title="<%=btm.getCommonText(request, CommonTextCategory.MONEY, "buttonVisualizePicture")%>"></span>
                </a>
            </div>
            <div class="wd_spesa"><p class="" title="{secondLevelItemDescription}">{secondLevelItemDescription}</p></div>
            <div class="wd_second_line clr">
                <div class="wd_quando left"><p>{secondLevelItemDate} - <span>{_amount_secondLevelItemAmount}</span></p></div>
            </div>
        </div>
    </div>
</script>
